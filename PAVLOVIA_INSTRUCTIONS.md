# Детальная инструкция: Создание эксперимента в PsychoPy Builder для Pavlovia

## Шаг 1: Подготовка файлов

1. Создайте папку для эксперимента (например, `pavlovia_exp`)
2. Скопируйте все изображения из папок `premium/`, `base/`, `control/` в эту папку
3. Убедитесь, что изображения названы последовательно (1.png, 2.png, ..., 9.png) в каждой папке

## Шаг 2: Создание эксперимента в Builder

### 2.1. Начало эксперимента

1. Откройте PsychoPy Builder
2. Создайте новый эксперимент
3. В настройках эксперимента (Experiment Settings):
   - **Exp Info**: Добавьте поле `participant` (текстовое)
   - **Data**: Убедитесь, что включено сохранение данных

### 2.2. Routine: "Ввод_номера"

Создайте Routine с компонентами:

**Компонент 1: Text (название: "приветствие")**
- Text: "Оценка потребительских предпочтений\n\nПожалуйста, введите ваш уникальный номер респондента:"
- Position: (0, 200)
- Size: (1.2, 0.3)

**Компонент 2: TextInput (название: "input_number")**
- Text: ""
- Position: (0, 0)
- Size: (0.5, 0.1)
- Store: `participant_number`

**Компонент 3: Keyboard (название: "key_continue")**
- Keys: return
- Store: `continue_key`

### 2.3. Routine: "Определение_группы" (Code компонент)

Добавьте компонент **Code** с кодом из файла `pavlovia_setup.py`

### 2.4. Routine: "Инструкция"

**Компонент: Text (название: "instruction_text")**
- Text: 
```
Уважаемый участник!

Благодарим вас за согласие принять участие в нашем исследовании. 
Ваша задача - оценить ряд товаров, как если бы вы рассматривали 
их в интернет-магазине.

Пожалуйста, внимательно ознакомьтесь с правилами:

Вам будет последовательно представлен ряд товаров. 
Ваша задача — оценить каждый из них по нескольким параметрам.

ПРОЦЕДУРА:

1. Вы увидите изображение товара и его цену

2. Нажмите на изображение товара, чтобы перейти к оценке

3. Ответьте на 3 вопроса о товаре

Важно: 

- Постарайтесь отвечать быстро и интуитивно, как при реальной покупке в интернете

- Не задумывайтесь слишком долго над ответами


Нажмите ПРОБЕЛ, чтобы начать
```
- Position: (0, 0)
- Wrap Width: 50
- Size: (1.2, 0.8)

**Компонент: Keyboard (название: "key_start")**
- Keys: space

### 2.5. Routine: "Показ_товара"

**Компонент 1: Text (название: "product_number")**
- Text: `"Товар " + str(product_number) + " из " + str(total_products)`
- Position: (0, -0.4)
- Size: (0.8, 0.1)

**Компонент 2: Image (название: "product_image")**
- Image: `$image_path` (из условия Loop)
- Position: (0, 0.1)
- Size: (0.7, 0.7) - адаптивно

**Компонент 3: Text (название: "click_instruction")**
- Text: "Нажмите на изображение товара, чтобы перейти к оценке"
- Position: (0, 0.5)
- Size: (0.8, 0.05)

**Компонент 4: Mouse (название: "mouse_click")**
- Buttons: left
- Store: `click_time`
- Start time: 0

**Компонент 5: Code (название: "reaction_time")**
- Code:
```python
if mouse_click.clicked_name:
    reaction_time = mouse_click.rt
else:
    reaction_time = 0
thisExp.addData('reaction_time', reaction_time)
```

### 2.6. Routine: "Вопрос_1_Справедливость"

**Компонент: RatingScale (название: "price_fairness")**
- Question: "1. Насколько справедливой вам кажется указанная цена товара?"
- Scale: 1-7
- Labels:
  - 1: "Совершенно несправедливо"
  - 2: "Очень несправедливо"
  - 3: "Скорее несправедливо"
  - 4: "Ни да, ни нет (Нейтрально)"
  - 5: "Скорее справедливо"
  - 6: "Очень справедливо"
  - 7: "Абсолютно справедливо"
- Position: (0, 0)
- Size: (1.0, 0.3)
- Marker: circle
- Marker Color: blue
- Store: `price_fairness`

### 2.7. Routine: "Вопрос_2_Максимальная_цена"

**Компонент 1: Text (название: "q2_text")**
- Text: "2. Какова максимальная сумма, которую вы были бы готовы заплатить за этот товар? (Укажите в рублях)"
- Position: (0, 0.3)
- Size: (1.0, 0.2)

**Компонент 2: TextInput (название: "max_price_input")**
- Text: ""
- Position: (0, 0)
- Size: (0.4, 0.1)
- Store: `max_price`

**Компонент 3: Keyboard (название: "key_enter")**
- Keys: return

### 2.8. Routine: "Вопрос_3_Вероятность"

**Компонент: RatingScale (название: "purchase_probability")**
- Question: "3. Насколько вероятно, что вы купили бы этот товар по указанной цене?"
- Scale: 1-7
- Labels:
  - 1: "Точно нет"
  - 2: "Крайне маловероятно"
  - 3: "Маловероятно"
  - 4: "Затрудняюсь ответить"
  - 5: "Вероятно"
  - 6: "Очень вероятно"
  - 7: "Определенно да"
- Position: (0, 0)
- Size: (1.0, 0.3)
- Store: `purchase_probability`

### 2.9. Routine: "Финальный_экран"

**Компонент 1: Rect (название: "finish_bg")**
- Fill Color: green
- Position: (0, 0)
- Size: (0.4, 0.1)

**Компонент 2: Text (название: "finish_text")**
- Text: "Завершить опрос"
- Position: (0, 0)
- Size: (0.3, 0.08)
- Color: white

**Компонент 3: Keyboard (название: "key_finish")**
- Keys: space

**Компонент 4: Text (название: "thank_you")**
- Text: "Thank you, goodbye!"
- Position: (0, -0.3)
- Size: (0.5, 0.1)

## Шаг 3: Настройка Loop для товаров

1. Создайте **Loop** с названием "products_loop"
2. Настройки Loop:
   - **Conditions file**: Создайте файл `conditions.xlsx` или используйте встроенный генератор
   - **Selected rows**: all
   - **Random seed**: random (для случайного порядка)
   - **Is trials**: 9 (количество товаров)

3. Структура условий (в Excel или CSV):
```
product_number, image_path
1, premium/1.png
2, premium/2.png
...
```

**ВАЖНО**: Создайте 3 версии условий для каждой группы:
- `conditions_premium.xlsx`
- `conditions_base.xlsx`
- `conditions_control.xlsx`

4. В Routine "Определение_группы" добавьте код:
```python
if group_key == 'premium':
    conditions_file = 'conditions_premium.xlsx'
elif group_key == 'base':
    conditions_file = 'conditions_base.xlsx'
else:
    conditions_file = 'conditions_control.xlsx'
```

## Шаг 4: Структура Flow

Расположите Routines в следующем порядке:

```
Ввод_номера
    ↓
Определение_группы
    ↓
Инструкция
    ↓
Loop: products_loop
    ├─ Показ_товара
    ├─ Вопрос_1_Справедливость
    ├─ Вопрос_2_Максимальная_цена
    └─ Вопрос_3_Вероятность
    ↓
Финальный_экран
```

## Шаг 5: Настройка для Pavlovia

1. **Синхронизация с Pavlovia**:
   - В Builder нажмите "Sync" (требуется аккаунт Pavlovia)
   - Эксперимент загрузится на сервер

2. **Загрузка изображений**:
   - В настройках эксперимента на Pavlovia загрузите все изображения
   - Убедитесь, что пути к изображениям корректны

3. **Настройка сбора данных**:
   - Pavlovia автоматически сохраняет данные в CSV
   - Данные доступны в разделе "Results"

4. **Получение ссылки**:
   - После синхронизации получите ссылку вида:
   - `https://run.pavlovia.org/ваш_логин/название_эксперимента`

## Шаг 6: Тестирование

1. Протестируйте эксперимент локально в Builder
2. Протестируйте онлайн версию на Pavlovia
3. Проверьте сбор данных

## Дополнительные настройки

### Балансировка групп в Pavlovia

Для автоматической балансировки по 15 участников в группе используйте встроенные функции Pavlovia или добавьте код:

```python
# В начале эксперимента
import random

# Простое случайное распределение (Pavlovia может балансировать автоматически)
groups = ['premium', 'base', 'control']
group_key = random.choice(groups)
```

### Сохранение данных

Pavlovia автоматически сохраняет:
- Все данные из `thisExp.addData()`
- Время реакции
- Ответы на вопросы
- Информацию об участнике

Данные можно скачать в CSV формате через веб-интерфейс Pavlovia.

---

## Альтернатива: Готовая структура

Если хотите, я могу создать готовый .psyexp файл, который можно импортировать в Builder. Но проще всего создать структуру вручную по этой инструкции.

